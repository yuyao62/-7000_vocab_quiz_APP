<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Ëã± ‚ûú ‰∏≠ Ê∏¨È©ó</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: #f5f5f5;
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .app {
      width: min(800px, 100%);
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 8px 22px rgba(0,0,0,.15);
      padding: 24px 40px 32px;
    }
    .top {
      text-align: center;
      margin-bottom: 18px;
    }
    .top h1 {
      margin: 0;
      font-size: 24px;
    }
    .meta {
      margin-top: 6px;
      color: #4b5563;
      font-size: 14px;
    }
    .controls {
      margin-top: 8px;
      font-size: 14px;
    }
    .controls select, .controls button {
      margin: 0 4px;
      padding: 4px 8px;
      font-size: 14px;
    }
    .word {
      text-align: center;
      font-size: 40px;
      font-weight: 600;
      margin: 26px 0 18px;
    }
    .options {
      max-width: 640px;
      margin: 0 auto 16px;
    }
    .option-btn {
      width: 100%;
      padding: 12px 16px;
      margin: 8px 0;
      font-size: 18px;
      text-align: center;
      background: #f9fafb;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      cursor: pointer;
      transition: background .1s, transform .05s, box-shadow .05s, border-color .1s;
    }
    .option-btn:hover {
      background: #eef2ff;
    }
    .option-btn.correct {
      background: #dcfce7;
      border-color: #16a34a;
    }
    .option-btn.wrong {
      background: #fee2e2;
      border-color: #b91c1c;
    }
    .sentence {
      text-align: center;
      color: #9ca3af;
      font-size: 14px;
      margin-top: 8px;
      min-height: 20px;
    }
    .bottom-row {
      margin-top: 14px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }
    .bottom-row button {
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
    }
    .msg {
      margin-top: 10px;
      text-align: center;
      font-size: 15px;
      min-height: 22px;
    }
    .msg.ok { color: #16a34a; }
    .msg.bad { color: #b91c1c; }
  </style>
</head>
<body>

<div class="app">
  <div class="top">
    <h1>Ëã± ‚ûú ‰∏≠ Ê∏¨È©ó</h1>
    <div class="meta">
      <span id="levelInfo">Level ?</span>„ÄÄ
      <span id="progress">Á¨¨ 0 / 0 È°å</span>
    </div>
    <div class="controls">
      LevelÔºö
      <select id="levelSelect"></select>
      È°åÊï∏Ôºö
      <select id="countSelect">
        <option value="5">5 È°å</option>
        <option value="10">10 È°å</option>
        <option value="20">20 È°å</option>
        <option value="50">50 È°å</option>
        <option value="ALL">ÂÖ®ÈÉ®</option>
      </select>
      <button id="startBtn">ÈñãÂßãÊ∏¨È©ó</button>
    </div>
  </div>

  <div class="word" id="word">ÔºàË´ãÂÖàÈÅ∏ Level ‰∏¶ÊåâÈñãÂßãÔºâ</div>

  <div class="options" id="options">
    <!-- ÈÅ∏È†ÖÊåâÈàïÊúÉÁî± JS ÂãïÊÖãÁî¢Áîü -->
  </div>

  <div class="sentence" id="sentence">
    <!-- Â¶ÇÊûúÊú™‰æÜ JSON Êúâ‰æãÂè•ÔºåÂèØ‰ª•ÊîæÈÄôË£°ÔºåÁèæÂú®ÂÖàÁïôÁ©∫ -->
  </div>

  <div class="bottom-row">
    <button id="speakBtn">üîä ÁôºÈü≥</button>
    <button id="showAnsBtn">ÁúãÁ≠îÊ°à</button>
    <button id="nextBtn">‰∏ã‰∏ÄÈ°å</button>
  </div>

  <div class="msg" id="msg"></div>
</div>

<script>
  let allVocab = [];
  let currentQuiz = [];
  let currentIndex = 0;
  let currentCorrect = null;
  let answered = false;

  const levelSelect = document.getElementById("levelSelect");
  const countSelect = document.getElementById("countSelect");
  const startBtn = document.getElementById("startBtn");
  const wordEl = document.getElementById("word");
  const optionsEl = document.getElementById("options");
  const levelInfoEl = document.getElementById("levelInfo");
  const progressEl = document.getElementById("progress");
  const msgEl = document.getElementById("msg");

  async function loadVocab() {
    const res = await fetch("vocab_ceec_1_6.json");
    allVocab = await res.json();

    // Âª∫ Level ÈÅ∏ÂñÆ
    const levels = [...new Set(allVocab.map(v => v.level))];
    levelSelect.innerHTML = levels.map(l => `<option value="${l}">${l}</option>`).join("");
  }

  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  function startQuiz() {
    const lv = levelSelect.value;
    let pool = allVocab.filter(v => v.level === lv);

    if (pool.length < 2) {
      alert("ÈÄôÂÄã Level ÂñÆÂ≠óÂ§™Â∞ëÔºåÊ≤íËæ¶Ê≥ïÂá∫È°å„ÄÇ");
      return;
    }

    shuffle(pool);

    const countVal = countSelect.value;
    const n = (countVal === "ALL") ? pool.length
                                   : Math.min(pool.length, parseInt(countVal, 10));

    currentQuiz = pool.slice(0, n);
    currentIndex = 0;

    levelInfoEl.textContent = lv;
    showQuestion();
  }

  function buildOptions(correctItem, pool) {
    const options = [correctItem];

    // ÂæûÂêå‰∏Ä pool ÊäΩÂÖ∂‰ªñ‰∏âÂÄãÂπ≤ÊìæÈÅ∏È†Ö
    const others = pool.filter(v => v !== correctItem);
    shuffle(others);
    while (options.length < 4 && others.length > 0) {
      options.push(others.pop());
    }

    shuffle(options);
    return options;
  }

  function showQuestion() {
    answered = false;
    msgEl.textContent = "";
    msgEl.className = "msg";

    if (currentIndex >= currentQuiz.length) {
      wordEl.textContent = "Ê∏¨È©óÁµêÊùü üéâ";
      optionsEl.innerHTML = "";
      progressEl.textContent = `Á¨¨ ${currentQuiz.length} / ${currentQuiz.length} È°å`;
      return;
    }

    const item = currentQuiz[currentIndex];
    currentCorrect = item;
    wordEl.textContent = item.word;
    progressEl.textContent = `Á¨¨ ${currentIndex + 1} / ${currentQuiz.length} È°å`;

    // Áî¢ÁîüÂõõÂÄãÈÅ∏È†Ö
    const opts = buildOptions(item, currentQuiz);
    optionsEl.innerHTML = "";
    opts.forEach(opt => {
      const btn = document.createElement("button");
      btn.className = "option-btn";
      btn.textContent = opt.definition;
      btn.onclick = () => chooseOption(btn, opt);
      optionsEl.appendChild(btn);
    });
  }

  function chooseOption(btn, chosenItem) {
    if (answered) return;
    answered = true;

    const buttons = Array.from(document.querySelectorAll(".option-btn"));
    buttons.forEach(b => b.disabled = true);

    // Ê®ôË®òÊ≠£Á¢∫Á≠îÊ°à
    buttons.forEach(b => {
      if (b.textContent === currentCorrect.definition) {
        b.classList.add("correct");
      }
    });

    if (chosenItem === currentCorrect) {
      msgEl.textContent = "‚úî Á≠îÂ∞ç‰∫ÜÔºÅ";
      msgEl.classList.add("ok");
    } else {
      msgEl.textContent = `‚úò Á≠îÈåØ‰∫ÜÔºåÊ≠£Á¢∫Á≠îÊ°àÊòØÔºö„Äå${currentCorrect.definition}„Äç`;
      msgEl.classList.add("bad");
      btn.classList.add("wrong");
    }
  }

  function showAnswer() {
    const buttons = Array.from(document.querySelectorAll(".option-btn"));
    buttons.forEach(b => {
      if (b.textContent === currentCorrect.definition) {
        b.classList.add("correct");
      }
    });
    msgEl.textContent = `Ê≠£Á¢∫Á≠îÊ°àÊòØÔºö„Äå${currentCorrect.definition}„Äç`;
    msgEl.className = "msg ok";
    answered = true;
  }

  function speakWord() {
    if (!currentCorrect) return;
    const utter = new SpeechSynthesisUtterance(currentCorrect.word);
    utter.lang = "en-US";
    speechSynthesis.cancel();
    speechSynthesis.speak(utter);
  }

  // Á∂ÅÂÆö‰∫ã‰ª∂
  startBtn.onclick = startQuiz;
  document.getElementById("nextBtn").onclick = () => {
    currentIndex++;
    showQuestion();
  };
  document.getElementById("showAnsBtn").onclick = showAnswer;
  document.getElementById("speakBtn").onclick = speakWord;

  loadVocab();
</script>

</body>
</html>
