<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Vocabulary Trainer Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #eef1f7;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .app {
      background: #ffffff;
      width: min(480px, 100%);
      margin: 24px;
      border-radius: 24px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.18);
      padding: 28px 28px 20px;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 24px;
      font-weight: 700;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: #64748b;
      margin-bottom: 18px;
      font-size: 14px;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 13px;
      color: #475569;
    }

    .stats {
      display: flex;
      gap: 8px;
      align-items: center;
      font-size: 13px;
    }

    .badge {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge-green {
      background: #dcfce7;
      color: #15803d;
    }

    .badge-red {
      background: #fee2e2;
      color: #b91c1c;
    }

    .badge-gray {
      background: #e2e8f0;
      color: #334155;
    }

    .level-select {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
    }

    select {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #cbd5f5;
      font-size: 13px;
      background: #f8fafc;
      outline: none;
    }

    .card {
      background: #f8fafc;
      border-radius: 16px;
      padding: 14px 14px 10px;
      margin-bottom: 18px;
    }

    .label {
      font-size: 13px;
      color: #64748b;
      margin-bottom: 4px;
    }

    .chinese {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #0f172a;
    }

    .level-tag {
      display: inline-block;
      padding: 2px 10px;
      border-radius: 999px;
      background: #e0f2fe;
      color: #0369a1;
      font-size: 12px;
      font-weight: 600;
    }

    .input-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 10px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid #cbd5f5;
      outline: none;
      font-size: 15px;
    }

    input[type="text"]:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px #6366f133;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-bottom: 6px;
    }

    button {
      flex: 1;
      padding: 9px 10px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.05s ease, box-shadow 0.05s ease, opacity 0.1s;
    }

    .btn-primary {
      background: #4f46e5;
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(79, 70, 229, 0.35);
    }

    .btn-secondary {
      background: #e2e8f0;
      color: #1e293b;
    }

    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    button:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }

    .answer-row {
      font-size: 14px;
      margin-bottom: 4px;
      min-height: 20px;
    }

    .answer-ok {
      color: #15803d;
    }

    .answer-wrong {
      color: #b91c1c;
    }

    .tip {
      font-size: 12px;
      color: #94a3b8;
      text-align: center;
      border-top: 1px dashed #e2e8f0;
      padding-top: 6px;
      margin-top: 4px;
    }

    @media (max-width: 480px) {
      .app {
        margin: 16px;
        padding: 22px 18px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Vocabulary Trainer</h1>
    <div class="subtitle">‰∏≠Êñá ‚ûú Ë´ãËº∏ÂÖ•Ëã±ÊñáÂñÆÂ≠ó</div>

    <div class="top-row">
      <div id="counter">È°åÁõÆÔºö0 / 0</div>
      <div class="stats">
        <span class="badge badge-green" id="correctBadge">‚úÖ 0</span>
        <span class="badge badge-red" id="wrongBadge">‚ùå 0</span>
        <span class="badge badge-gray" id="accuracyBadge">0%</span>
      </div>
    </div>

    <!-- Level ÈÅ∏Êìá -->
    <div class="top-row" style="margin-bottom: 10px;">
      <div class="level-select">
        <span>Âá∫È°å LevelÔºö</span>
        <select id="levelSelect">
          <!-- JS ÂãïÊÖãÂ°´ÂÖ• -->
        </select>
      </div>
      <span style="font-size: 12px; color:#94a3b8;" id="poolInfo"></span>
    </div>

    <!-- È°åÁõÆÂç°Áâá -->
    <div class="card">
      <div class="label">‰∏≠Êñá / Ëß£Èáã</div>
      <div class="chinese" id="chineseText">ËºâÂÖ•‰∏≠‚Ä¶</div>
      <div class="level-tag" id="levelTag">Level ?</div>
    </div>

    <!-- ‰ΩúÁ≠îÂçÄ -->
    <div class="input-row">
      <div style="display:flex; justify-content: space-between; align-items:center;">
        <span class="label">Ë´ãËº∏ÂÖ•Ëã±ÊñáÂñÆÂ≠ó</span>
        <button id="showAnswerBtn" class="btn-secondary" style="flex:none; padding:4px 10px; font-size:12px;">
          È°ØÁ§∫Á≠îÊ°à
        </button>
      </div>
      <input
        type="text"
        id="answerInput"
        placeholder="Âú®ÈÄôË£°Ëº∏ÂÖ•Ëã±ÊñáÔºåEnter ÊàñÊåâ„ÄéÊ™¢Êü•„Äè"
        autocomplete="off"
      />
    </div>

    <div class="btn-row">
      <button id="checkBtn" class="btn-primary">Ê™¢Êü•Á≠îÊ°à</button>
      <button id="nextBtn" class="btn-secondary">‰∏ã‰∏ÄÈ°å</button>
    </div>

    <div class="answer-row" id="feedback"></div>

    <div class="tip">
      TipÔºöÊåâ Enter ‰πüÂèØ‰ª•Âø´ÈÄüÈÄÅÂá∫Á≠îÊ°àÔºõÂè≥‰∏äËßíÂèØ‰ª•ÂàáÊèõÂá∫È°å Level„ÄÇ
    </div>
  </div>

  <script>
    let allVocab = [];
    let filteredVocab = [];
    let currentIndex = 0;
    let totalAsked = 0;
    let correctCount = 0;
    let wrongCount = 0;
    let currentItem = null;

    const counterEl = document.getElementById("counter");
    const correctBadge = document.getElementById("correctBadge");
    const wrongBadge = document.getElementById("wrongBadge");
    const accuracyBadge = document.getElementById("accuracyBadge");
    const poolInfo = document.getElementById("poolInfo");

    const chineseText = document.getElementById("chineseText");
    const levelTag = document.getElementById("levelTag");
    const levelSelect = document.getElementById("levelSelect");

    const answerInput = document.getElementById("answerInput");
    const checkBtn = document.getElementById("checkBtn");
    const nextBtn = document.getElementById("nextBtn");
    const showAnswerBtn = document.getElementById("showAnswerBtn");
    const feedbackEl = document.getElementById("feedback");

    function normalizeString(s) {
      return (s || "")
        .trim()
        .lowerCase?.() ?? (s || "").trim().toLowerCase()
        .replace(/\s+/g, " ");
    }

    async function loadVocab() {
      try {
        const res = await fetch("vocab_ceec_1_6.json");
        const data = await res.json();
        allVocab = Array.isArray(data) ? data : [];

        if (allVocab.length === 0) {
          chineseText.textContent = "vocab_ceec_1_6.json ÂÖßÂÆπÊòØÁ©∫ÁöÑ";
          return;
        }

        buildLevelOptions();
        applyLevelFilter();
        updateStats();
        showNextQuestion();
      } catch (err) {
        console.error(err);
        chineseText.textContent = "ÁÑ°Ê≥ïËºâÂÖ• vocab_ceec_1_6.jsonÔºåË´ãÊ™¢Êü•Ê™îÊ°àË∑ØÂæëËàáÊ†ºÂºè„ÄÇ";
      }
    }

    function buildLevelOptions() {
      const levelSet = new Set();

      allVocab.forEach(item => {
        const lv =
          item.level || item.Level || item.level_name || item.levelName || null;
        if (lv) levelSet.add(String(lv));
      });

      levelSelect.innerHTML = "";

      const optAll = document.createElement("option");
      optAll.value = "ALL";
      optAll.textContent = "ÂÖ®ÈÉ® Level";
      levelSelect.appendChild(optAll);

      const levelArr = Array.from(levelSet);
      levelArr.sort((a, b) => {
        const na = parseInt(String(a).replace(/\D/g, "")) || 0;
        const nb = parseInt(String(b).replace(/\D/g, "")) || 0;
        if (na === 0 && nb === 0) return String(a).localeCompare(String(b));
        return na - nb;
      });

      levelArr.forEach(lv => {
        const opt = document.createElement("option");
        opt.value = lv;
        opt.textContent = lv;
        levelSelect.appendChild(opt);
      });

      const hasLevel3 = levelArr.some(lv => /3/.test(String(lv)));
      if (hasLevel3) {
        levelSelect.value = levelArr.find(lv => /3/.test(String(lv)));
      } else {
        levelSelect.value = "ALL";
      }

      levelSelect.addEventListener("change", () => {
        totalAsked = 0;
        correctCount = 0;
        wrongCount = 0;
        updateStats();
        applyLevelFilter();
        showNextQuestion();
      });
    }

    function applyLevelFilter() {
      const selected = levelSelect.value;
      if (selected === "ALL") {
        filteredVocab = [...allVocab];
      } else {
        filteredVocab = allVocab.filter(item => {
          const lv =
            item.level || item.Level || item.level_name || item.levelName || "";
          return String(lv) === selected;
        });
      }

      if (filteredVocab.length === 0) {
        chineseText.textContent = "ÈÄôÂÄã Level Ê≤íÊúâÂñÆÂ≠óÔºåË´ãÊèõ‰∏ÄÂÄã Level„ÄÇ";
      }

      shuffleArray(filteredVocab);

      poolInfo.textContent = filteredVocab.length
        ? `È°åÂ∫´Ôºö${filteredVocab.length} Â≠ó`
        : "";
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function showNextQuestion() {
      feedbackEl.textContent = "";
      feedbackEl.className = "answer-row";
      answerInput.value = "";
      answerInput.focus();

      if (!filteredVocab.length) {
        chineseText.textContent = "ÁõÆÂâçÈ°åÂ∫´ÊòØÁ©∫ÁöÑÔºåË´ãÊ™¢Êü• Level Êàñ JSON Ê™î„ÄÇ";
        levelTag.textContent = "Level ?";
        return;
      }

      if (currentIndex >= filteredVocab.length) {
        shuffleArray(filteredVocab);
        currentIndex = 0;
      }

      currentItem = filteredVocab[currentIndex];
      currentIndex++;

      const cn =
        currentItem.definition ||   // ‚Üê ‰∏≠ÊñáÂú®ÈÄôË£°ÔºÅ
        currentItem.chinese ||
        currentItem.meaning ||
        currentItem.cn ||
        currentItem.translation ||
        "(Êâæ‰∏çÂà∞‰∏≠ÊñáÊ¨Ñ‰Ωç)";

      const lv =
        currentItem.level ||
        currentItem.Level ||
        currentItem.level_name ||
        currentItem.levelName ||
        "Êú™Ê®ôË®ò Level";

      chineseText.textContent = cn;
      levelTag.textContent = lv;

      counterEl.textContent = `È°åÁõÆÔºö${totalAsked + 1} / ${filteredVocab.length}`;
    }

    function checkAnswer() {
      if (!currentItem) return;

      const userAns = normalizeString(answerInput.value);
      const correct =
        normalizeString(
          currentItem.word ||
            currentItem.english ||
            currentItem.en ||
            currentItem.term
        );

      if (!correct) {
        feedbackEl.textContent = "Ê≠§È°åÂñÆÂ≠óË≥áÊñôÁº∫Â∞ëËã±ÊñáÊ¨Ñ‰Ωç„ÄÇ";
        feedbackEl.className = "answer-row answer-wrong";
        return;
      }

      totalAsked++;
      if (userAns && userAns === correct) {
        correctCount++;
        feedbackEl.textContent = `‚úÖ Ê≠£Á¢∫ÔºÅÁ≠îÊ°àÔºö${correct}`;
        feedbackEl.className = "answer-row answer-ok";
      } else {
        wrongCount++;
        feedbackEl.textContent = `‚ùå Á≠îÈåØ‰∫ÜÔºåÊ≠£Á¢∫Á≠îÊ°àÊòØÔºö${correct}`;
        feedbackEl.className = "answer-row answer-wrong";
      }

      updateStats();
    }

    function updateStats() {
      correctBadge.textContent = `‚úÖ ${correctCount}`;
      wrongBadge.textContent = `‚ùå ${wrongCount}`;
      const total = correctCount + wrongCount;
      const acc = total === 0 ? 0 : Math.round((correctCount / total) * 100);
      accuracyBadge.textContent = `${acc}%`;
    }

    function showAnswer() {
      if (!currentItem) return;
      const correct =
        currentItem.word ||
        currentItem.english ||
        currentItem.en ||
        currentItem.term ||
        "(Ê≤íÊúâËã±ÊñáÊ¨Ñ‰Ωç)";
      feedbackEl.textContent = `üëâ Á≠îÊ°àÊòØÔºö${correct}`;
      feedbackEl.className = "answer-row";
    }

    checkBtn.addEventListener("click", checkAnswer);
    nextBtn.addEventListener("click", () => {
      showNextQuestion();
    });
    showAnswerBtn.addEventListener("click", showAnswer);

    answerInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        checkAnswer();
      }
    });

    loadVocab();
  </script>
</body>
</html>
