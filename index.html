<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Vocabulary Trainer Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f5fb;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      background: #ffffff;
      margin: 24px;
      padding: 24px 20px 28px;
      border-radius: 16px;
      max-width: 480px;
      width: 100%;
      box-shadow: 0 12px 35px rgba(15, 23, 42, 0.12);
    }
    h1 {
      font-size: 1.6rem;
      margin-top: 0;
      margin-bottom: 8px;
      text-align: center;
    }
    .subtitle {
      text-align: center;
      font-size: 0.85rem;
      color: #64748b;
      margin-bottom: 18px;
    }
    .stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      margin-bottom: 12px;
      color: #475569;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #e2e8f0;
      color: #475569;
      margin-left: 4px;
    }
    .card {
      background: #f8fafc;
      border-radius: 12px;
      padding: 14px 12px;
      margin-bottom: 10px;
    }
    .label {
      font-size: 0.8rem;
      color: #64748b;
      margin-bottom: 4px;
    }
    .question-text {
      font-size: 1.05rem;
      font-weight: 600;
      color: #0f172a;
    }
    .level-tag {
      font-size: 0.75rem;
      color: #0f172a;
      background: #e0f2fe;
      border-radius: 999px;
      padding: 2px 8px;
      display: inline-block;
      margin-top: 6px;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      margin-top: 4px;
      border-radius: 10px;
      border: 1px solid #cbd5f5;
      font-size: 1rem;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }
    input[type="text"]:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.2);
    }
    .btn-row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    button {
      flex: 1;
      padding: 9px 12px;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.06s ease, background 0.15s ease;
    }
    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }
    .btn-primary {
      background: #4f46e5;
      color: white;
      box-shadow: 0 6px 16px rgba(79, 70, 229, 0.3);
    }
    .btn-secondary {
      background: #e2e8f0;
      color: #111827;
    }
    .btn-small {
      flex: 0;
      padding: 6px 10px;
      font-size: 0.8rem;
    }
    .result {
      margin-top: 8px;
      font-size: 0.9rem;
    }
    .result.correct {
      color: #16a34a;
    }
    .result.wrong {
      color: #dc2626;
    }
    .answer {
      margin-top: 2px;
      font-size: 0.9rem;
      color: #334155;
    }
    .wrong-list {
      margin-top: 16px;
      font-size: 0.85rem;
      max-height: 180px;
      overflow-y: auto;
      border-top: 1px dashed #e2e8f0;
      padding-top: 8px;
    }
    .wrong-item {
      margin-bottom: 4px;
      color: #475569;
    }
    .wrong-item span.word {
      font-weight: 600;
      color: #0f172a;
    }
    .footer {
      margin-top: 16px;
      font-size: 0.75rem;
      text-align: center;
      color: #94a3b8;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Vocabulary Trainer</h1>
    <div class="subtitle">ä¸­æ–‡ âœ è«‹è¼¸å…¥è‹±æ–‡å–®å­—</div>

    <div class="stats">
      <div>é¡Œç›®ï¼š<span id="qIndex">0</span> / <span id="qTotal">0</span></div>
      <div>
        âœ… <span id="correctCount">0</span>
        &nbsp;&nbsp;âŒ <span id="wrongCount">0</span>
        <span class="badge" id="accuracyBadge">0%</span>
      </div>
    </div>

    <div class="card">
      <div class="label">ä¸­æ–‡ / è§£é‡‹</div>
      <div class="question-text" id="questionText">è¼‰å…¥ä¸­...</div>
      <div class="level-tag" id="levelTag" style="display:none;"></div>
    </div>

    <div class="card">
      <div class="label">
        è«‹è¼¸å…¥è‹±æ–‡å–®å­—
        <button class="btn-small btn-secondary" id="toggleMaskBtn" type="button">é¡¯ç¤ºç­”æ¡ˆ</button>
      </div>
      <input type="text" id="answerInput" placeholder="åœ¨é€™è£¡è¼¸å…¥è‹±æ–‡ï¼ŒEnter æˆ–æŒ‰ã€æª¢æŸ¥ã€" autocomplete="off" />
      <div class="btn-row">
        <button class="btn-primary" id="checkBtn" type="button">æª¢æŸ¥ç­”æ¡ˆ</button>
        <button class="btn-secondary" id="nextBtn" type="button">ä¸‹ä¸€é¡Œ</button>
      </div>
      <div class="result" id="resultArea"></div>
      <div class="answer" id="answerArea"></div>
    </div>

    <div class="wrong-list" id="wrongList"></div>

    <div class="footer">
      Tipï¼šæŒ‰ Enter ä¹Ÿå¯ä»¥å¿«é€Ÿé€å‡ºç­”æ¡ˆ
    </div>
  </div>

  <script>
    // ==== è¨­å®šï¼šæ ¹æ“šä½ çš„ vocab.json æ¬„ä½åç¨±èª¿æ•´ ====
    // å‡è¨­ vocab.json æ˜¯ [{ "word": "apple", "definition": "è˜‹æœ", "level": "Level 1" }, ...]
    const FIELD_WORD = "word";
    const FIELD_DEF = "definition";
    const FIELD_LEVEL = "level"; // å¦‚æœæ²’æœ‰ levelï¼Œå¯ä»¥å¿½ç•¥

    let vocabList = [];
    let currentIndex = -1;
    let currentItem = null;
    let askedCount = 0;
    let correctCount = 0;
    let wrongCount = 0;
    let wrongItems = [];
    let showMask = false;

    const qIndexSpan = document.getElementById("qIndex");
    const qTotalSpan = document.getElementById("qTotal");
    const correctSpan = document.getElementById("correctCount");
    const wrongSpan = document.getElementById("wrongCount");
    const accuracyBadge = document.getElementById("accuracyBadge");

    const questionText = document.getElementById("questionText");
    const levelTag = document.getElementById("levelTag");
    const answerInput = document.getElementById("answerInput");
    const resultArea = document.getElementById("resultArea");
    const answerArea = document.getElementById("answerArea");
    const wrongListDiv = document.getElementById("wrongList");
    const toggleMaskBtn = document.getElementById("toggleMaskBtn");
    const checkBtn = document.getElementById("checkBtn");
    const nextBtn = document.getElementById("nextBtn");

    async function loadVocab() {
      try {
        const resp = await fetch("vocab.json");
        if (!resp.ok) throw new Error("è®€å– vocab.json å¤±æ•—");
        const data = await resp.json();

        // åŸºæœ¬é˜²å‘†ï¼šç¢ºä¿æ˜¯é™£åˆ—
        if (!Array.isArray(data) || data.length === 0) {
          questionText.textContent = "vocab.json å…§å®¹ç‚ºç©ºæˆ–æ ¼å¼éŒ¯èª¤ã€‚";
          return;
        }

        vocabList = data;
        qTotalSpan.textContent = vocabList.length.toString();
        nextQuestion();
      } catch (err) {
        console.error(err);
        questionText.textContent = "ç„¡æ³•è¼‰å…¥ vocab.jsonï¼Œè«‹æª¢æŸ¥æª”æ¡ˆè·¯å¾‘èˆ‡æ ¼å¼ã€‚";
      }
    }

    function pickRandomIndex() {
      if (vocabList.length === 0) return -1;
      return Math.floor(Math.random() * vocabList.length);
    }

    function updateStats() {
      qIndexSpan.textContent = askedCount.toString();
      correctSpan.textContent = correctCount.toString();
      wrongSpan.textContent = wrongCount.toString();

      const totalAnswered = correctCount + wrongCount;
      const acc = totalAnswered === 0 ? 0 : Math.round((correctCount / totalAnswered) * 100);
      accuracyBadge.textContent = acc + "%";
    }

    function renderWrongList() {
      if (wrongItems.length === 0) {
        wrongListDiv.textContent = "ç›®å‰æ²’æœ‰éŒ¯é¡Œ ğŸ‘Œ";
        return;
      }
      wrongListDiv.innerHTML = "<strong>éŒ¯é¡Œè¨˜éŒ„ï¼š</strong><br/>";
      wrongItems.forEach((item, idx) => {
        const div = document.createElement("div");
        div.className = "wrong-item";
        div.innerHTML =
          (idx + 1) +
          ". <span class='word'>" +
          item[FIELD_WORD] +
          "</span> â€” " +
          (item[FIELD_DEF] || "") +
          (item[FIELD_LEVEL] ? " (" + item[FIELD_LEVEL] + ")" : "");
        wrongListDiv.appendChild(div);
      });
    }

    function nextQuestion() {
      if (!vocabList || vocabList.length === 0) return;

      currentIndex = pickRandomIndex();
      currentItem = vocabList[currentIndex];

      const defText = currentItem[FIELD_DEF] || "(ç„¡è§£é‡‹)";
      questionText.textContent = defText;

      const level = currentItem[FIELD_LEVEL];
      if (level) {
        levelTag.style.display = "inline-block";
        levelTag.textContent = level;
      } else {
        levelTag.style.display = "none";
      }

      answerInput.value = "";
      answerInput.focus();
      resultArea.textContent = "";
      resultArea.className = "result";
      answerArea.textContent = "";
      showMask = false;
      toggleMaskBtn.textContent = "é¡¯ç¤ºç­”æ¡ˆ";

      askedCount += 1;
      updateStats();
    }

    function checkAnswer() {
      if (!currentItem) return;

      const userAns = answerInput.value.trim();
      const trueAns = (currentItem[FIELD_WORD] || "").trim();

      if (!trueAns) {
        resultArea.textContent = "æ­¤å–®å­—åœ¨ vocab.json ä¸­æ²’æœ‰ word æ¬„ä½ã€‚";
        resultArea.className = "result wrong";
        return;
      }

      if (!userAns) {
        resultArea.textContent = "è«‹å…ˆè¼¸å…¥ç­”æ¡ˆå†æª¢æŸ¥ï½";
        resultArea.className = "result wrong";
        return;
      }

      const isCorrect = userAns.toLowerCase() === trueAns.toLowerCase();

      if (isCorrect) {
        resultArea.textContent = "âœ… ç­”å°äº†ï¼";
        resultArea.className = "result correct";
        correctCount += 1;
      } else {
        resultArea.textContent = "âŒ å†è©¦è©¦çœ‹ï½";
        resultArea.className = "result wrong";
        wrongCount += 1;

        // åŠ å…¥éŒ¯é¡Œï¼ˆé¿å…é‡è¤‡è¨˜éŒ„åŒä¸€é¡Œï¼‰
        if (!wrongItems.includes(currentItem)) {
          wrongItems.push(currentItem);
        }
        renderWrongList();
      }

      answerArea.textContent = "æ­£ç¢ºç­”æ¡ˆï¼š " + trueAns;
      updateStats();
    }

    function toggleMask() {
      if (!currentItem) return;
      showMask = !showMask;
      if (showMask) {
        answerArea.textContent = "æ­£ç¢ºç­”æ¡ˆï¼š " + (currentItem[FIELD_WORD] || "");
        toggleMaskBtn.textContent = "éš±è—ç­”æ¡ˆ";
      } else {
        answerArea.textContent = "";
        toggleMaskBtn.textContent = "é¡¯ç¤ºç­”æ¡ˆ";
      }
    }

    checkBtn.addEventListener("click", checkAnswer);
    nextBtn.addEventListener("click", nextQuestion);
    toggleMaskBtn.addEventListener("click", toggleMask);

    answerInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        checkAnswer();
      }
    });

    loadVocab();
  </script>
</body>
</html>
