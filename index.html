<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Vocabulary Trainer Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #eef1f7;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .app {
      background: #ffffff;
      width: min(480px, 100%);
      margin: 24px;
      border-radius: 24px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.18);
      padding: 28px 28px 20px;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 24px;
      font-weight: 700;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: #64748b;
      margin-bottom: 18px;
      font-size: 14px;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 13px;
      color: #475569;
    }

    .stats {
      display: flex;
      gap: 8px;
      align-items: center;
      font-size: 13px;
    }

    .badge {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge-green {
      background: #dcfce7;
      color: #15803d;
    }

    .badge-red {
      background: #fee2e2;
      color: #b91c1c;
    }

    .badge-gray {
      background: #e2e8f0;
      color: #334155;
    }

    .level-select {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
    }

    select {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #cbd5f5;
      font-size: 13px;
      background: #f8fafc;
      outline: none;
    }

    .card {
      background: #f8fafc;
      border-radius: 16px;
      padding: 14px 14px 10px;
      margin-bottom: 18px;
    }

    .label {
      font-size: 13px;
      color: #64748b;
      margin-bottom: 4px;
    }

    .chinese {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #0f172a;
    }

    .level-tag {
      display: inline-block;
      padding: 2px 10px;
      border-radius: 999px;
      background: #e0f2fe;
      color: #0369a1;
      font-size: 12px;
      font-weight: 600;
    }

    .input-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 10px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid #cbd5f5;
      outline: none;
      font-size: 15px;
    }

    input[type="text"]:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px #6366f133;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-bottom: 6px;
    }

    button {
      flex: 1;
      padding: 9px 10px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.05s ease, box-shadow 0.05s ease, opacity 0.1s;
    }

    .btn-primary {
      background: #4f46e5;
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(79, 70, 229, 0.35);
    }

    .btn-secondary {
      background: #e2e8f0;
      color: #1e293b;
    }

    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    button:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }

    .answer-row {
      font-size: 14px;
      margin-bottom: 4px;
      min-height: 20px;
    }

    .answer-ok {
      color: #15803d;
    }

    .answer-wrong {
      color: #b91c1c;
    }

    .tip {
      font-size: 12px;
      color: #94a3b8;
      text-align: center;
      border-top: 1px dashed #e2e8f0;
      padding-top: 6px;
      margin-top: 4px;
    }

    @media (max-width: 480px) {
      .app {
        margin: 16px;
        padding: 22px 18px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Vocabulary Trainer</h1>
    <div class="subtitle">ä¸­æ–‡ âœ è«‹è¼¸å…¥è‹±æ–‡å–®å­—</div>

    <div class="top-row">
      <div id="counter">é¡Œç›®ï¼š0 / 0</div>
      <div class="stats">
        <span class="badge badge-green" id="correctBadge">âœ… 0</span>
        <span class="badge badge-red" id="wrongBadge">âŒ 0</span>
        <span class="badge badge-gray" id="accuracyBadge">0%</span>
      </div>
    </div>

    <!-- Level é¸æ“‡ -->
    <div class="top-row" style="margin-bottom: 10px;">
      <div class="level-select">
        <span>å‡ºé¡Œ Levelï¼š</span>
        <select id="levelSelect">
          <!-- é€™è£¡æœƒç”± JS å‹•æ…‹å¡«å…¥ -->
        </select>
      </div>
      <span style="font-size: 12px; color:#94a3b8;" id="poolInfo"></span>
    </div>

    <!-- é¡Œç›®å¡ç‰‡ -->
    <div class="card">
      <div class="label">ä¸­æ–‡ / è§£é‡‹</div>
      <div class="chinese" id="chineseText">è¼‰å…¥ä¸­â€¦</div>
      <div class="level-tag" id="levelTag">Level ?</div>
    </div>

    <!-- ä½œç­”å€ -->
    <div class="input-row">
      <div style="display:flex; justify-content: space-between; align-items:center;">
        <span class="label">è«‹è¼¸å…¥è‹±æ–‡å–®å­—</span>
        <button id="showAnswerBtn" class="btn-secondary" style="flex:none; padding:4px 10px; font-size:12px;">
          é¡¯ç¤ºç­”æ¡ˆ
        </button>
      </div>
      <input
        type="text"
        id="answerInput"
        placeholder="åœ¨é€™è£¡è¼¸å…¥è‹±æ–‡ï¼ŒEnter æˆ–æŒ‰ã€æª¢æŸ¥ã€"
        autocomplete="off"
      />
    </div>

    <div class="btn-row">
      <button id="checkBtn" class="btn-primary">æª¢æŸ¥ç­”æ¡ˆ</button>
      <button id="nextBtn" class="btn-secondary">ä¸‹ä¸€é¡Œ</button>
    </div>

    <div class="answer-row" id="feedback"></div>

    <div class="tip">
      Tipï¼šæŒ‰ Enter ä¹Ÿå¯ä»¥å¿«é€Ÿé€å‡ºç­”æ¡ˆï¼›å³ä¸Šè§’å¯ä»¥åˆ‡æ›å‡ºé¡Œ Levelã€‚
    </div>
  </div>

  <script>
    // ========= è³‡æ–™çµæ§‹ =========
    let allVocab = [];        // å…¨éƒ¨å–®å­—
    let filteredVocab = [];   // ä¾ç…§é¸å®š Level éæ¿¾å¾Œçš„é¡Œåº«
    let currentIndex = 0;
    let totalAsked = 0;
    let correctCount = 0;
    let wrongCount = 0;
    let currentItem = null;

    const counterEl = document.getElementById("counter");
    const correctBadge = document.getElementById("correctBadge");
    const wrongBadge = document.getElementById("wrongBadge");
    const accuracyBadge = document.getElementById("accuracyBadge");
    const poolInfo = document.getElementById("poolInfo");

    const chineseText = document.getElementById("chineseText");
    const levelTag = document.getElementById("levelTag");
    const levelSelect = document.getElementById("levelSelect");

    const answerInput = document.getElementById("answerInput");
    const checkBtn = document.getElementById("checkBtn");
    const nextBtn = document.getElementById("nextBtn");
    const showAnswerBtn = document.getElementById("showAnswerBtn");
    const feedbackEl = document.getElementById("feedback");

    // ========= å·¥å…·å‡½å¼ =========

    function normalizeString(s) {
      return (s || "")
        .trim()
        .toLowerCase()
        .replace(/\s+/g, " ");
    }

    // å¾ vocab.json è®€è³‡æ–™
    async function loadVocab() {
      try {
        const res = await fetch("vocab.json");
        const data = await res.json();
        allVocab = Array.isArray(data) ? data : [];

        if (allVocab.length === 0) {
          chineseText.textContent = "vocab.json å…§å®¹æ˜¯ç©ºçš„";
          return;
        }

        buildLevelOptions();
        applyLevelFilter();
        updateStats();
        showNextQuestion();

      } catch (err) {
        console.error(err);
        chineseText.textContent = "ç„¡æ³•è®€å– vocab.jsonï¼Œè«‹ç¢ºèªæª”æ¡ˆå­˜åœ¨ä¸”æ ¼å¼æ­£ç¢ºã€‚";
      }
    }

    // ä¾ç…§è³‡æ–™ä¸­çš„ level æ¬„ä½å»ºç«‹ Level ä¸‹æ‹‰é¸å–®
    function buildLevelOptions() {
      const levelSet = new Set();

      allVocab.forEach(item => {
        const lv =
          item.level || item.Level || item.level_name || item.levelName || null;
        if (lv) levelSet.add(String(lv));
      });

      // å…ˆåŠ ã€Œå…¨éƒ¨ã€
      levelSelect.innerHTML = "";
      const optAll = document.createElement("option");
      optAll.value = "ALL";
      optAll.textContent = "å…¨éƒ¨ Level";
      levelSelect.appendChild(optAll);

      const levelArr = Array.from(levelSet);

      // ç›¡é‡ä»¥æ•¸å­—æ’åºï¼ˆä¾‹å¦‚ Level 1, Level 2, Level 3â€¦ï¼‰
      levelArr.sort((a, b) => {
        const na = parseInt(String(a).replace(/\D/g, "")) || 0;
        const nb = parseInt(String(b).replace(/\D/g, "")) || 0;
        if (na === 0 && nb === 0) return String(a).localeCompare(String(b));
        return na - nb;
      });

      levelArr.forEach(lv => {
        const opt = document.createElement("option");
        opt.value = lv;
        opt.textContent = lv;
        levelSelect.appendChild(opt);
      });

      // å¦‚æœæœ‰ Level 3ï¼Œé è¨­é¸ Level 3ï¼Œå¦å‰‡å°±é¸å…¨éƒ¨
      const hasLevel3 = levelArr.some(lv => /3/.test(String(lv)));
      if (hasLevel3) {
        levelSelect.value = levelArr.find(lv => /3/.test(String(lv)));
      } else {
        levelSelect.value = "ALL";
      }

      levelSelect.addEventListener("change", () => {
        // åˆ‡æ› Level æ™‚ï¼Œé‡ç½®çµ±è¨ˆä¸¦é‡æ–°å‡ºé¡Œ
        totalAsked = 0;
        correctCount = 0;
        wrongCount = 0;
        updateStats();
        applyLevelFilter();
        showNextQuestion();
      });
    }

    // ä¾ç…§ç›®å‰é¸å®šçš„ Level éæ¿¾é¡Œåº«
    function applyLevelFilter() {
      const selected = levelSelect.value;
      if (selected === "ALL") {
        filteredVocab = [...allVocab];
      } else {
        filteredVocab = allVocab.filter(item => {
          const lv =
            item.level || item.Level || item.level_name || item.levelName || "";
          return String(lv) === selected;
        });
      }

      if (filteredVocab.length === 0) {
        chineseText.textContent = "é€™å€‹ Level æ²’æœ‰å–®å­—ï¼Œè«‹æ›ä¸€å€‹ Levelã€‚";
      }

      // æ‰“äº‚é †åº
      shuffleArray(filteredVocab);

      poolInfo.textContent = filteredVocab.length
        ? `é¡Œåº«ï¼š${filteredVocab.length} å­—`
        : "";
    }

    // æ´—ç‰Œ
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    // é¡¯ç¤ºä¸‹ä¸€é¡Œ
    function showNextQuestion() {
      feedbackEl.textContent = "";
      feedbackEl.className = "answer-row";
      answerInput.value = "";
      answerInput.focus();

      if (!filteredVocab.length) {
        chineseText.textContent = "ç›®å‰é¡Œåº«æ˜¯ç©ºçš„ï¼Œè«‹æª¢æŸ¥ Level æˆ– vocab.jsonã€‚";
        levelTag.textContent = "Level ?";
        return;
      }

      if (currentIndex >= filteredVocab.length) {
        // åˆ°å°¾å·´äº†å°±é‡æ–°æ´—ç‰Œ
        shuffleArray(filteredVocab);
        currentIndex = 0;
      }

      currentItem = filteredVocab[currentIndex];
      currentIndex++;

      const cn =
        currentItem.chinese ||
        currentItem.meaning ||
        currentItem.cn ||
        currentItem.translation ||
        "(æ‰¾ä¸åˆ°ä¸­æ–‡æ¬„ä½)";
      const lv =
        currentItem.level ||
        currentItem.Level ||
        currentItem.level_name ||
        currentItem.levelName ||
        "æœªæ¨™è¨˜ Level";

      chineseText.textContent = cn;
      levelTag.textContent = lv;

      counterEl.textContent = `é¡Œç›®ï¼š${totalAsked + 1} / ${filteredVocab.length}`;
    }

    // æª¢æŸ¥ç­”æ¡ˆ
    function checkAnswer() {
      if (!currentItem) return;

      const userAns = normalizeString(answerInput.value);
      const correct =
        normalizeString(
          currentItem.word ||
            currentItem.english ||
            currentItem.en ||
            currentItem.term
        );

      if (!correct) {
        feedbackEl.textContent = "æ­¤é¡Œå–®å­—è³‡æ–™ç¼ºå°‘è‹±æ–‡æ¬„ä½ã€‚";
        feedbackEl.className = "answer-row answer-wrong";
        return;
      }

      totalAsked++;
      if (userAns && userAns === correct) {
        correctCount++;
        feedbackEl.textContent = `âœ… æ­£ç¢ºï¼ç­”æ¡ˆï¼š${correct}`;
        feedbackEl.className = "answer-row answer-ok";
      } else {
        wrongCount++;
        feedbackEl.textContent = `âŒ ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${correct}`;
        feedbackEl.className = "answer-row answer-wrong";
      }

      updateStats();
    }

    function updateStats() {
      correctBadge.textContent = `âœ… ${correctCount}`;
      wrongBadge.textContent = `âŒ ${wrongCount}`;
      const total = correctCount + wrongCount;
      const acc = total === 0 ? 0 : Math.round((correctCount / total) * 100);
      accuracyBadge.textContent = `${acc}%`;
    }

    function showAnswer() {
      if (!currentItem) return;
      const correct =
        currentItem.word ||
        currentItem.english ||
        currentItem.en ||
        currentItem.term ||
        "(æ²’æœ‰è‹±æ–‡æ¬„ä½)";
      feedbackEl.textContent = `ğŸ‘‰ ç­”æ¡ˆæ˜¯ï¼š${correct}`;
      feedbackEl.className = "answer-row";
    }

    // ========= äº‹ä»¶ç¶å®š =========
    checkBtn.addEventListener("click", checkAnswer);
    nextBtn.addEventListener("click", () => {
      showNextQuestion();
    });
    showAnswerBtn.addEventListener("click", showAnswer);

    answerInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        checkAnswer();
      }
    });

    // ========= å•Ÿå‹• =========
    loadVocab();
  </script>
</body>
</html>
