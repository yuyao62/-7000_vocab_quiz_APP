<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Vocabulary Trainer</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #eef1f7;
    margin: 0;
    display: flex;
    justify-content: center;
    padding: 20px;
  }
  .app {
    width: 420px;
    background: #fff;
    padding: 24px;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,.15);
  }
  h1 { text-align:center; margin:0 0 8px; }
  .label { color:#475569; font-size:14px; margin-bottom:4px; }
  .ch { font-size:20px; font-weight:600; margin-bottom:6px; }
  .level { font-size:12px; color:#0369a1; background:#e0f2fe; padding:2px 8px; border-radius:12px; display:inline-block; }

  select, input {
    width: 100%;
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #cbd5e1;
    font-size: 15px;
    margin-bottom: 10px;
  }
  button {
    padding:10px;
    border-radius:10px;
    font-size:15px;
    cursor:pointer;
    border:none;
    width:48%;
  }
  .primary { background:#4f46e5; color:#fff; }
  .secondary { background:#e2e8f0; }
  .row { display:flex; justify-content:space-between; margin-top:6px; }
  .msg { min-height:22px; margin-top:8px; font-size:14px; }
  .ok { color:#15803d; }
  .wrong { color:#b91c1c; }
</style>
</head>

<body>
<div class="app">
  <h1>Vocabulary Trainer</h1>

  <div class="label">選擇 Level</div>
  <select id="levelSelect"></select>

  <div class="label">中文 / 解釋</div>
  <div id="chinese" class="ch"></div>
  <div id="levelTag" class="level"></div>

  <div class="label" style="margin-top:14px;">請輸入英文</div>
  <input id="inputWord" placeholder="輸入英文後按 Enter 或按按鈕">

  <div class="row">
    <button class="primary" id="checkBtn">檢查答案</button>
    <button class="secondary" id="nextBtn">下一題</button>
  </div>

  <div id="msg" class="msg"></div>
  <div id="stats" class="label" style="text-align:center; margin-top:10px;"></div>
</div>

<script>
let vocab = [];
let filtered = [];
let index = 0;

let correct = 0, wrong = 0;

const chinese = document.getElementById("chinese");
const levelTag = document.getElementById("levelTag");
const levelSelect = document.getElementById("levelSelect");
const msg = document.getElementById("msg");
const stats = document.getElementById("stats");
const inputWord = document.getElementById("inputWord");

async function loadVocab() {
  const res = await fetch("vocab_ceec_1_6.json");
  vocab = await res.json();

  const levels = [...new Set(vocab.map(v => v.level))];
  levelSelect.innerHTML = `<option value="ALL">全部</option>` +
    levels.map(l => `<option>${l}</option>`).join("");

  levelSelect.addEventListener("change", applyFilter);
  applyFilter();
}

function applyFilter() {
  const lv = levelSelect.value;
  filtered = (lv === "ALL") ? [...vocab] : vocab.filter(v => v.level === lv);

  shuffle(filtered);
  index = 0;
  correct = wrong = 0;
  updateStats();
  nextQuestion();
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

function nextQuestion() {
  msg.textContent = "";
  inputWord.value = "";
  inputWord.focus();

  if (index >= filtered.length) { shuffle(filtered); index = 0; }

  const item = filtered[index];
  chinese.textContent = item.definition;
  levelTag.textContent = item.level;
}

function checkAnswer() {
  const item = filtered[index];
  const ans = inputWord.value.trim().toLowerCase();
  const correctWord = item.word.toLowerCase();

  if (ans === correctWord) {
    msg.textContent = `✔ 正確！${correctWord}`;
    msg.className = "msg ok";
    correct++;
  } else {
    msg.textContent = `✘ 錯誤，正確答案：${correctWord}`;
    msg.className = "msg wrong";
    wrong++;
  }

  index++;
  updateStats();
}

function updateStats() {
  const total = correct + wrong;
  const acc = total === 0 ? 0 : Math.round((correct / total) * 100);
  stats.textContent = `正確：${correct}　錯誤：${wrong}　正確率：${acc}%`;
}

document.getElementById("checkBtn").onclick = checkAnswer;
document.getElementById("nextBtn").onclick = nextQuestion;

inputWord.addEventListener("keydown", e => {
  if (e.key === "Enter") checkAnswer();
});

loadVocab();
</script>

</body>
</html>
